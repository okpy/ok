sudo: required
dist: trusty
language: python
services:
  - docker
  - redis
python:
    - "3.5"
env:
  global:
     - OK_ENV=test
  matrix:
    - USE_DOCKER=1
    - USE_NATIVE=1
install:
  - if [ -n "$USE_DOCKER" ]; then make docker-build; fi
  - if [ -n "$USE_NATIVE" ]; then pip install -r requirements.txt; fi
script:
  - if [ -n "$USE_DOCKER" ]; then docker run -it cs61a/ok-server py.test tests/ --ignore=tests/test_job.py; fi
  - if [ -n "$USE_NATIVE" ]; then make test; fi
after_success:
  - if [ -n "$USE_NATIVE" ]; then pip install python-coveralls; fi
  - if [ -n "$USE_NATIVE" ]; then coveralls; fi
notifications:
  email: false
  slack:
    on_success: never
    on_failure: always
    secure: mGqCgRCFMB89AKsYVOZI79sifCFOLaQkuY3rvFKMitpD1GYQQpkBbZ9Z1SWi0VQV63oOKTQBrPCeDSwhZMaJA/dCZZIuz6e9nkVyJJUIrqAuH9PjgQr6FM4FkKzVLpHdPnXIikAvUAKiPRzzj8z4KO1EohBRR/xb2/4TpoWrkSA=
