<span class="cover ng-scope" ng-click="closeDetails()"></span>
<div class="sidebars col-md-4" ng-controller="AssignmentDashController">
    <div class="sidebar colored group ng-scope" ng-repeat="assign in assignments" 
         id="{{ assign.assignment.id }}" color="{{ randomColor(assign.assignment).color }}">
        <div class="sidebar-header">
            <div class="close" ng-click="closeDetails()"><span>+</span></div>
            <p class="blob-status ng-scope" ng-if="!assign.final.final_submission">Not submitted
                yet</p>
            <h2 class="blob-title ng-binding">{{ assign.assignment.display_name }}</h2>

            <p class="blob-shiftcopy blob-copy ng-binding"><span class="icon-clock"></span>due
                {{ ::assign.assignment.due_date | amCalendar }}</p>
        </div>
        <div ng-if="assign.group.group_info.member.length > 1">
            <h2 class="sidebar-subtitle">Group</h2>
            <ul class="sidebar-list">
                <li ng-repeat="member in assign.group.group_info.member">{{ member.email[0] }}
                    <span class="close" ng-click="removeMember(assign.group.group_info, member)"><span class="icon-x">+</span></span>
                </li>
            </ul>
            <a ng-click="" ng-if="assign.group.group_info.member.length > 0" class="action">Save</a>
        </div>
        <h2 class="sidebar-subtitle" ng-if="assign.group.group_info.invited.length > 0">Invited Members</h2>
        <ul class="sidebar-list" ng-if="assign.group.group_info.invited.length > 0">
            <li ng-repeat="invited in assign.group.group_info.invited">{{ invited.email[0] }}
                <div ng-if="assign.group.invited" class="options">
                    <span class="option good" ng-click="acceptInvite(assign.group.group_info)"><span class="check"></span></span>
                    <span class="option bad" ng-click="rejectInvite(assign.group.group_info)"><span class="close white"><span class="icon-x">+</span></span></span>
                </div>
                <span class="close" ng-if="!assign.group.invited"
                      ng-click="removeMember(assign.group.group_info, invited)">
                    <span class="icon-x">+</span></span>
            </li>
        </ul>
        <form name="inviteGroup" ng-if="assign.assignment.max_group_size > 1">
            <h3 class="sidebar-subtitle">Invite to Group</h3>

            <input type="email" class="invite email" placeholder="ok@cs61a.org" ng-model="assign.invitee" required>
            <a ng-click="addMember(assign, assign.invitee)" class="action">Invite</a>
        </form>
        
        <h2 class="sidebar-subtitle">Submissions</h2>
        <ul class="sidebar-list">
            <li ng-if="!assign.submissions || assign.submissions.length == 0">No submissions found.</li>
            <li ng-repeat="subm in assign.submissions | orderBy:'created':true">
                <a class="flag"
                   ng-class=" {active: assign.final.final_submission && subm.id == assign.final.backup.id }">
                    <span class="label left"><p>Flagged for Grading</p></span>
                    <span class="cloth"></span>
                    <span class="stem"></span>
                </a>
                {{ subm.created | amCalendar }} by {{ subm.submitter.email[0] }}
                <a ui-sref="submission.detail({courseId: courseId, submissionId:backup.id})">view
                    <span class="arrow right dark fat"></span>
                </a>
            </li>
        </ul>
        <a ng-if="assign.submissions.length > 0"
           ng-click="getSubmissions(assign.assignment.id, true);"
           class="action">Load More</a>
        <h2 class="sidebar-subtitle">Backups</h2>
        <ul class="sidebar-list">
            <li ng-if="!assign.backups || assign.backups.length == 0">No backups found. Have you run ok?</li>
            <li ng-repeat="backup in assign.backups | orderBy:'created':true">
                {{ backup.created | amCalendar }} by {{ backup.submitter.email[0] }}
                <a ui-sref="submission.detail({courseId: courseId, submissionId:backup.id})">view
                    <span class="arrow right dark fat"></span>
                </a>
            </li>
        </ul>
        <a ng-if="assign.backups.length > 0"
           ng-click="getBackups(assign.assignment, true);"
           class="action">Load More</a>
    </div>
</div>